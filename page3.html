<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Page 3 - Messages</title>
<style>
  /* Your existing styles remain unchanged */
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

<!-- Your existing HTML/UI for page3 -->
<div id="messages-container"></div>

<input type="text" id="message-input" placeholder="Type your message">
<button onclick="sendMessage()">Send</button>

<script>
  // ====== Firebase Configuration ======
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_MESSAGING_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // ====== Check Login ======
  auth.onAuthStateChanged(user => {
    if (user) {
      window.currentUser = {
        name: user.displayName || "Anonymous",
        photoURL: user.photoURL || "default-profile.png",
        uid: user.uid
      };
      loadMessages();
    } else {
      alert("You must log in to access this page.");
      window.location.href = "login.html"; // redirect to login
    }
  });

  // ====== Load Messages ======
  function loadMessages() {
    db.collection("messages").orderBy("timestamp")
      .onSnapshot(snapshot => {
        const container = document.getElementById("messages-container");
        container.innerHTML = ""; // clear previous
        snapshot.forEach(doc => {
          const data = doc.data();
          const messageDiv = document.createElement("div");
          messageDiv.style.marginBottom = "10px";
          messageDiv.innerHTML = `
            <img src="${data.photoURL}" style="width:30px;height:30px;border-radius:50%;vertical-align:middle;">
            <strong>${data.name}:</strong> ${data.text}
          `;
          container.appendChild(messageDiv);
        });
      });
  }

  // ====== Send Message ======
  function sendMessage() {
    const input = document.getElementById("message-input");
    const text = input.value.trim();
    if (!text) return;

    db.collection("messages").add({
      name: window.currentUser.name,
      photoURL: window.currentUser.photoURL,
      text: text,
      uid: window.currentUser.uid,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    input.value = "";
  }
</script>
</body>
</html>
