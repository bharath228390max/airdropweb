<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reply Guys Place</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap');

body { font-family: 'Orbitron', sans-serif; background: radial-gradient(circle at center, #020202 10%, #000000 90%); color: #fff; margin: 0; padding: 0; overflow-x: hidden; min-height: 100vh; }
.stars { position: fixed; top:0; left:0; width:100%; height:100%; background: transparent url('https://www.transparenttextures.com/patterns/stardust.png') repeat; opacity:0.25; z-index:0; }
h1 { text-align:center; color:#66b3ff; font-size:32px; margin-top:30px; z-index:2; position:relative; }
.add-friend-btn { display:block; margin:20px auto; padding:10px 20px; background:transparent; border:2px solid #66b3ff; color:#66b3ff; font-size:16px; border-radius:12px; cursor:pointer; transition: all 0.3s ease; position:relative; z-index:2; }
.add-friend-btn:hover { background:#66b3ff; color:#000; box-shadow:0 0 20px #66b3ff; }
.friend-box { width:85%; max-width:700px; margin:30px auto; padding:20px; border-radius:20px; background: rgba(255,255,255,0.05); border:1.5px solid rgba(102,179,255,0.3); box-shadow:0 0 25px rgba(102,179,255,0.2); backdrop-filter:blur(10px); position:relative; z-index:2; }
.friend-item { display:flex; align-items:center; gap:15px; padding:10px; border-bottom:1px solid rgba(255,255,255,0.1); }
.friend-item:last-child { border-bottom:none; }
.friend-item img { width:50px; height:50px; border-radius:50%; border:2px solid #66b3ff; }
.friend-info { flex-grow:1; }
.friend-info h3 { margin:0; color:#66b3ff; font-size:18px; }
.friend-info p { margin:4px 0 0; color: rgba(255,255,255,0.85); font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:400px; }
.reply-btn { padding:6px 14px; border-radius:8px; border:1.5px solid #66b3ff; background:transparent; color:#66b3ff; font-size:14px; cursor:pointer; transition:0.3s; }
.reply-btn:hover { background:#66b3ff; color:#000; box-shadow:0 0 15px #66b3ff; }
.popup, .confirm-popup { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.95); border:2px solid #66b3ff; border-radius:20px; padding:25px; width:320px; text-align:center; box-shadow:0 0 25px rgba(102,179,255,0.4); z-index:10; }
.popup input { width:80%; padding:10px; margin-top:10px; border-radius:8px; border:1.5px solid #66b3ff; background:transparent; color:#66b3ff; font-size:15px; }
.popup button, .confirm-popup button { margin:10px; padding:8px 16px; border-radius:8px; border:1.5px solid #66b3ff; background:transparent; color:#66b3ff; cursor:pointer; transition:0.3s; }
.popup button:hover, .confirm-popup button:hover { background:#66b3ff; color:#000; box-shadow:0 0 15px #66b3ff; }
</style>
</head>
<body>
<div class="stars"></div>

<h1>Engage with Friends</h1>
<button class="add-friend-btn" id="addFriendBtn">Add Friend</button>
<div class="friend-box" id="friendsList"><p style="text-align:center; color:rgba(255,255,255,0.6)">Loading friends...</p></div>

<div class="popup" id="popupBox">
<h2 style="color:#66b3ff;">Enter Friendâ€™s Twitter Username</h2>
<input type="text" id="friendIdInput" placeholder="@username">
<div>
  <button id="saveFriend">Add</button>
  <button id="closePopup">Back</button>
</div>
</div>

<div class="confirm-popup" id="confirmRemove">
<p id="confirmText" style="color:#66b3ff;"></p>
<button id="confirmYes">Yes Remove</button>
<button id="confirmNo">No Keep</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBc2r-7g7UYtGZBV_JNAfEG_7sYY7UBsC4",
  authDomain: "rezo-chat.firebaseapp.com",
  projectId: "rezo-chat",
  storageBucket: "rezo-chat.firebasestorage.app",
  messagingSenderId: "300513819927",
  appId: "1:300513819927:web:2c5f6a7f411273e1880b52"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const addFriendBtn = document.getElementById("addFriendBtn");
const popupBox = document.getElementById("popupBox");
const closePopup = document.getElementById("closePopup");
const saveFriend = document.getElementById("saveFriend");
const friendIdInput = document.getElementById("friendIdInput");
const friendsList = document.getElementById("friendsList");

const confirmRemove = document.getElementById("confirmRemove");
const confirmText = document.getElementById("confirmText");
const confirmYes = document.getElementById("confirmYes");
const confirmNo = document.getElementById("confirmNo");

addFriendBtn.addEventListener("click",()=>popupBox.style.display="block");
closePopup.addEventListener("click",()=>popupBox.style.display="none");

let currentUserId = null;
let removeIndex = null;

onAuthStateChanged(auth, async (user)=>{
  if(!user){ alert("Please log in first."); window.location.href="index.html"; return; }
  currentUserId = user.uid;
  await loadFriends();
});

async function loadFriends(){
  const docRef = doc(db,"profiles",currentUserId);
  const snap = await getDoc(docRef);
  if(!snap.exists() || !snap.data().friends || snap.data().friends.length===0){
    friendsList.innerHTML=`<p style="text-align:center; color:rgba(255,255,255,0.6)">No friends added yet.</p>`;
    return;
  }
  const friends = snap.data().friends;
  friendsList.innerHTML = "";

  friends.forEach((friend,index)=>{
    const div = document.createElement("div");
    div.className="friend-item";

    let lastPostText="No post time available";
    if(friend.lastPostTime){
      const d = new Date(friend.lastPostTime);
      const hours=d.getHours().toString().padStart(2,'0');
      const minutes=d.getMinutes().toString().padStart(2,'0');
      lastPostText=`Last posted: ${hours}:${minutes}`;
    }

    div.innerHTML=`
      <img src="${friend.img}" alt="pfp">
      <div class="friend-info">
        <h3>@${friend.name}</h3>
        <p>${lastPostText}</p>
      </div>
      <button class="reply-btn">Reply</button>
      <button class="reply-btn" style="margin-left:5px; border-color:#ff4c4c; color:#ff4c4c;">Remove</button>
    `;
    friendsList.appendChild(div);

    // Attach event listeners properly
    const replyBtn = div.querySelector(".reply-btn:nth-of-type(1)");
    replyBtn.addEventListener("click",()=> window.open(`https://x.com/${friend.name}`,'_blank'));

    const removeBtn = div.querySelector(".reply-btn:nth-of-type(2)");
    removeBtn.addEventListener("click", ()=> confirmRemoveFriend(index, friend.name));
  });
}

function confirmRemoveFriend(index,name){
  removeIndex=index;
  confirmText.innerText=`Do you want to remove @${name}?`;
  confirmRemove.style.display="block";
}

confirmNo.addEventListener("click",()=>confirmRemove.style.display="none");

confirmYes.addEventListener("click",async ()=>{
  const docRef = doc(db,"profiles",currentUserId);
  const snap = await getDoc(docRef);
  if(!snap.exists()) return;
  let friends = snap.data().friends || [];
  friends.splice(removeIndex,1);
  await updateDoc(docRef,{friends});
  confirmRemove.style.display="none";
  loadFriends();
});

saveFriend.addEventListener("click",async ()=>{
  const friendName=friendIdInput.value.trim().replace("@","");
  if(!friendName) return alert("Enter a valid username");
  const docRef=doc(db,"profiles",currentUserId);
  const snap=await getDoc(docRef);
  let friends = snap.exists() && Array.isArray(snap.data().friends) ? snap.data().friends : [];
  if(friends.some(f=>f.name===friendName)){ alert("Friend already added!"); return; }

  const friendData = {
    img:`https://unavatar.io/twitter/${friendName}`,
    name:friendName,
    lastPostTime:new Date().toISOString()
  };
  friends.push(friendData);
  await updateDoc(docRef,{friends});
  popupBox.style.display="none";
  friendIdInput.value="";
  loadFriends();
});
</script>
</body>
</html>
